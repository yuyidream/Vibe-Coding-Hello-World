# Nginx配置文件 - Hello World 管理后台
# 放置位置: /www/server/panel/vhost/nginx/123.249.68.162.conf
# 或者: /etc/nginx/sites-available/hello-world

server {
    listen 80;
    server_name 123.249.68.162 _;
    
    # 网站根目录
    root /www/wwwroot/hello-world;
    index index.html;
    
    # 访问日志
    access_log /www/wwwlogs/hello-world-access.log;
    error_log /www/wwwlogs/hello-world-error.log;
    
    # 静态文件（主页和管理后台HTML）
    location / {
        try_files $uri $uri/ =404;
    }
    
    # API接口反向代理到FastAPI后端
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        
        # 传递真实IP和主机信息
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # 禁用缓冲以支持流式响应
        proxy_buffering off;
    }
    
    # 静态资源目录
    location /static/ {
        alias /www/wwwroot/hello-world/static/;
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
    
    # 管理后台访问限制（可选，增强安全性）
    # location /admin.html {
    #     # 限制允许访问的IP地址
    #     # allow 你的IP地址;
    #     # deny all;
    # }
    
    # 安全头部
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # 隐藏Nginx版本号
    server_tokens off;
    
    # gzip压缩
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss;
}

# HTTPS配置（可选，需要SSL证书）
# server {
#     listen 443 ssl http2;
#     server_name 123.249.68.162;
#     
#     root /www/wwwroot/hello-world;
#     index index.html;
#     
#     # SSL证书配置
#     ssl_certificate /path/to/your/certificate.crt;
#     ssl_certificate_key /path/to/your/private.key;
#     
#     # SSL优化配置
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     
#     # 其他location配置与HTTP相同
#     location / {
#         try_files $uri $uri/ =404;
#     }
#     
#     location /api/ {
#         proxy_pass http://127.0.0.1:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
#     
#     location /static/ {
#         alias /www/wwwroot/hello-world/static/;
#         expires 7d;
#     }
#     
#     access_log /www/wwwlogs/hello-world-ssl-access.log;
#     error_log /www/wwwlogs/hello-world-ssl-error.log;
# }
